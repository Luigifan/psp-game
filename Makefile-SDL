#SDL Makefile
OS = meme

ifeq ($(OS),Windows_NT)
    OS = WIN32
else
    UNAME_S := $(shell uname -s)
    ifeq ($(UNAME_S),Linux)
        OS = LINUX
    endif
    ifeq ($(UNAME_S),Darwin)
        OS = OSX
    endif
endif


TARGET = analogue-sdl
PKGCONFIG = $(shell which pkg-config)

SDL2INCLUDE = $(shell $(PKGCONFIG) —cflags sdl2)
SDL2MIXERINCLUDE = $(shell $(PKGCONFIG) —cflags SDL2_mixer)
SDL2IMAGEINCLUDE = $(shell $(PKGCONFIG) —cflags SDL2_image)
SDL2TTFINCLUDE = $(shell $(PKGCONFIG) —cflags SDL2_ttf)

ifeq ($(OS),OSX)
	SDL2INCLUDE = /usr/local/include/
	SDL2MIXERINCLUDE = /usr/local/include/
	SDL2IMAGEINCLUDE = /usr/local/include/
	SDL2TTFINCLUDE = /usr/local/include/
endif


CFLAGS = -I$(SDL2INCLUDE) -I$(SDL2MIXERINCLUDE) -I$(SDL2IMAGEINCLUDE) -I$(SDL2TTFINCLUDE) $(shell $(PKGCONFIG) --cflags lua5.2) -DSDL_VERS
LIBS = $(shell $(PKGCONFIG) --libs sdl2) $(shell $(PKGCONFIG) --libs SDL2_ttf) $(shell $(PKGCONFIG) --libs SDL2_image) $(shell $(PKGCONFIG) --libs SDL2_mixer) $(shell $(PKGCONFIG) --libs lua5.2) -lm

LOCAL_DEPS = sound/*.c graphics/*.c sprites/*.c level-editor/ui/*.c level-editor/*.c input/*.c camera/*.c map/*.c map/lua/*.c player/*.c serialization/*.c vector/*.c message-box/*.c *.c

compile:
	gcc $(CFLAGS) -Wall $(LOCAL_DEPS) -o gen/$(TARGET) $(LIBS)
run:
	gen/$(TARGET)
edit:
	gen/$(TARGET) --level-editor
clean:
	rm -rf src/*.o src/map/*.o src/player/*.o src/serialization/*.o src/sprites/*.o src/vector/*.o
	rm gen/$(TARGET)
